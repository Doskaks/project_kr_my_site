listen {
  port = {{ nginx_log_exporter_port }}
  address = "0.0.0.0"
}

namespace "nginx" {
  source = {
    files = [
      "/var/log/nginx/access.log"
    ]
  }
  
  format = "$remote_addr - $remote_user [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\""
  
  labels {
    app = "nginx"
  }
  
  metrics {
    - name: "http_requests_total"
      help = "Total HTTP requests"
      type = "counter"
      match {
        status = "2xx"
      }
    
    - name: "http_request_duration_seconds"
      help = "HTTP request duration in seconds"
      type = "histogram"
      buckets = [0.1, 0.5, 1, 2, 5]
  }
}